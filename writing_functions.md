writing_functions
================
2022-11-06

## Z-scores!!

Let’s compute the z-score version of a list of numbers

``` r
x_vec = rnorm(25, mean = 7, sd = 4)
(x_vec - mean(x_vec))/ sd(x_vec)
```

    ##  [1] -0.33378306 -0.07583963  0.31372936 -0.89443207 -1.40810525  0.55942353
    ##  [7]  0.52240758  0.33598957  1.30627495  1.15664844  0.93594892  0.11045554
    ## [13] -0.33146339 -0.60855587 -0.12427308  0.26590702 -1.05301488  0.01648828
    ## [19] -0.44792733  0.61005988  1.47897617 -1.13640883 -0.79786960  2.02752490
    ## [25] -2.42816116

Suppose you want to do this function

``` r
z_scores = function(x){
  if(!is.numeric(x)){stop("Z scores only work for numbers")}
  if(length(x)<3){stop("Z scores really only work if you have three or more numbers")}
  (z= x - mean(x))/ sd(x)}
```

``` r
z_scores(x = x_vec)
```

    ##  [1] -0.33378306 -0.07583963  0.31372936 -0.89443207 -1.40810525  0.55942353
    ##  [7]  0.52240758  0.33598957  1.30627495  1.15664844  0.93594892  0.11045554
    ## [13] -0.33146339 -0.60855587 -0.12427308  0.26590702 -1.05301488  0.01648828
    ## [19] -0.44792733  0.61005988  1.47897617 -1.13640883 -0.79786960  2.02752490
    ## [25] -2.42816116

``` r
z_scores(x = 1:10)
```

    ##  [1] -1.4863011 -1.1560120 -0.8257228 -0.4954337 -0.1651446  0.1651446
    ##  [7]  0.4954337  0.8257228  1.1560120  1.4863011

``` r
z_scores(x = rbinom(1000,1,.6))
```

    ##    [1]  0.859297  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297
    ##    [8] -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578 -1.162578
    ##   [15]  0.859297 -1.162578  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##   [22] -1.162578 -1.162578  0.859297  0.859297 -1.162578  0.859297  0.859297
    ##   [29] -1.162578 -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##   [36]  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578  0.859297
    ##   [43] -1.162578 -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##   [50] -1.162578 -1.162578 -1.162578  0.859297 -1.162578 -1.162578 -1.162578
    ##   [57] -1.162578  0.859297 -1.162578  0.859297 -1.162578  0.859297 -1.162578
    ##   [64] -1.162578  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##   [71] -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578  0.859297
    ##   [78] -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578  0.859297
    ##   [85]  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297  0.859297
    ##   [92] -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297 -1.162578
    ##   [99]  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578
    ##  [106]  0.859297  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [113]  0.859297 -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [120] -1.162578 -1.162578  0.859297 -1.162578 -1.162578 -1.162578 -1.162578
    ##  [127] -1.162578  0.859297  0.859297  0.859297 -1.162578  0.859297  0.859297
    ##  [134] -1.162578  0.859297 -1.162578 -1.162578 -1.162578  0.859297  0.859297
    ##  [141]  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578 -1.162578
    ##  [148]  0.859297 -1.162578 -1.162578  0.859297  0.859297 -1.162578 -1.162578
    ##  [155]  0.859297  0.859297 -1.162578 -1.162578  0.859297 -1.162578  0.859297
    ##  [162]  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297  0.859297
    ##  [169]  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578 -1.162578
    ##  [176]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [183] -1.162578  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [190]  0.859297  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [197]  0.859297  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578
    ##  [204]  0.859297  0.859297 -1.162578 -1.162578 -1.162578 -1.162578 -1.162578
    ##  [211]  0.859297  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [218]  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297  0.859297
    ##  [225]  0.859297  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [232]  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297  0.859297
    ##  [239] -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578
    ##  [246]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [253]  0.859297 -1.162578  0.859297  0.859297 -1.162578 -1.162578 -1.162578
    ##  [260] -1.162578 -1.162578  0.859297 -1.162578 -1.162578  0.859297  0.859297
    ##  [267]  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297 -1.162578
    ##  [274]  0.859297 -1.162578  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [281]  0.859297 -1.162578  0.859297 -1.162578 -1.162578  0.859297  0.859297
    ##  [288]  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297 -1.162578
    ##  [295] -1.162578 -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [302]  0.859297  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [309]  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578  0.859297
    ##  [316]  0.859297  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578
    ##  [323]  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [330]  0.859297  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [337] -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578 -1.162578
    ##  [344] -1.162578  0.859297 -1.162578 -1.162578 -1.162578 -1.162578  0.859297
    ##  [351]  0.859297 -1.162578 -1.162578 -1.162578 -1.162578  0.859297  0.859297
    ##  [358] -1.162578  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297
    ##  [365]  0.859297 -1.162578  0.859297  0.859297  0.859297  0.859297  0.859297
    ##  [372] -1.162578  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [379]  0.859297 -1.162578  0.859297 -1.162578 -1.162578  0.859297 -1.162578
    ##  [386]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297
    ##  [393]  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297  0.859297
    ##  [400]  0.859297 -1.162578  0.859297 -1.162578  0.859297 -1.162578 -1.162578
    ##  [407]  0.859297  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578
    ##  [414] -1.162578  0.859297 -1.162578 -1.162578  0.859297  0.859297 -1.162578
    ##  [421]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297
    ##  [428]  0.859297 -1.162578 -1.162578 -1.162578  0.859297 -1.162578 -1.162578
    ##  [435]  0.859297  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [442] -1.162578  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297
    ##  [449]  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [456] -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297  0.859297
    ##  [463]  0.859297  0.859297 -1.162578 -1.162578  0.859297 -1.162578  0.859297
    ##  [470]  0.859297 -1.162578  0.859297  0.859297 -1.162578 -1.162578  0.859297
    ##  [477] -1.162578  0.859297 -1.162578  0.859297 -1.162578 -1.162578  0.859297
    ##  [484] -1.162578  0.859297 -1.162578 -1.162578 -1.162578  0.859297 -1.162578
    ##  [491]  0.859297  0.859297 -1.162578 -1.162578 -1.162578  0.859297  0.859297
    ##  [498]  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578  0.859297
    ##  [505]  0.859297 -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [512] -1.162578 -1.162578  0.859297 -1.162578 -1.162578  0.859297  0.859297
    ##  [519]  0.859297  0.859297  0.859297  0.859297 -1.162578 -1.162578  0.859297
    ##  [526] -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578  0.859297
    ##  [533] -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578 -1.162578
    ##  [540] -1.162578  0.859297 -1.162578 -1.162578 -1.162578 -1.162578 -1.162578
    ##  [547] -1.162578  0.859297 -1.162578  0.859297  0.859297 -1.162578 -1.162578
    ##  [554] -1.162578  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [561] -1.162578 -1.162578 -1.162578 -1.162578 -1.162578 -1.162578  0.859297
    ##  [568]  0.859297  0.859297  0.859297 -1.162578 -1.162578 -1.162578 -1.162578
    ##  [575] -1.162578 -1.162578 -1.162578  0.859297 -1.162578 -1.162578 -1.162578
    ##  [582] -1.162578  0.859297  0.859297  0.859297  0.859297 -1.162578  0.859297
    ##  [589]  0.859297  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [596] -1.162578  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [603]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297
    ##  [610]  0.859297  0.859297 -1.162578  0.859297 -1.162578  0.859297 -1.162578
    ##  [617] -1.162578  0.859297 -1.162578 -1.162578  0.859297  0.859297 -1.162578
    ##  [624] -1.162578 -1.162578 -1.162578  0.859297  0.859297 -1.162578 -1.162578
    ##  [631] -1.162578 -1.162578 -1.162578  0.859297  0.859297 -1.162578 -1.162578
    ##  [638] -1.162578 -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [645]  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578  0.859297
    ##  [652]  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297  0.859297
    ##  [659]  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297 -1.162578
    ##  [666]  0.859297  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [673] -1.162578 -1.162578  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [680]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297
    ##  [687] -1.162578 -1.162578 -1.162578  0.859297 -1.162578  0.859297 -1.162578
    ##  [694]  0.859297  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297
    ##  [701]  0.859297  0.859297 -1.162578 -1.162578  0.859297  0.859297 -1.162578
    ##  [708]  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578
    ##  [715]  0.859297 -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [722] -1.162578 -1.162578 -1.162578  0.859297 -1.162578 -1.162578 -1.162578
    ##  [729]  0.859297 -1.162578 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [736]  0.859297  0.859297  0.859297 -1.162578 -1.162578  0.859297  0.859297
    ##  [743]  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297  0.859297
    ##  [750]  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297 -1.162578
    ##  [757] -1.162578  0.859297 -1.162578 -1.162578 -1.162578  0.859297 -1.162578
    ##  [764]  0.859297  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297
    ##  [771] -1.162578 -1.162578 -1.162578  0.859297 -1.162578 -1.162578 -1.162578
    ##  [778]  0.859297  0.859297  0.859297  0.859297 -1.162578 -1.162578  0.859297
    ##  [785]  0.859297 -1.162578 -1.162578 -1.162578 -1.162578 -1.162578  0.859297
    ##  [792]  0.859297 -1.162578  0.859297  0.859297 -1.162578  0.859297  0.859297
    ##  [799]  0.859297 -1.162578  0.859297  0.859297  0.859297 -1.162578 -1.162578
    ##  [806] -1.162578 -1.162578 -1.162578  0.859297 -1.162578 -1.162578  0.859297
    ##  [813]  0.859297  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578
    ##  [820] -1.162578  0.859297  0.859297 -1.162578 -1.162578 -1.162578  0.859297
    ##  [827]  0.859297 -1.162578 -1.162578 -1.162578  0.859297  0.859297  0.859297
    ##  [834]  0.859297 -1.162578 -1.162578  0.859297 -1.162578 -1.162578 -1.162578
    ##  [841] -1.162578  0.859297 -1.162578 -1.162578  0.859297 -1.162578  0.859297
    ##  [848]  0.859297  0.859297  0.859297  0.859297 -1.162578 -1.162578 -1.162578
    ##  [855] -1.162578  0.859297  0.859297  0.859297 -1.162578  0.859297  0.859297
    ##  [862]  0.859297 -1.162578  0.859297 -1.162578  0.859297 -1.162578 -1.162578
    ##  [869]  0.859297  0.859297 -1.162578  0.859297  0.859297  0.859297  0.859297
    ##  [876]  0.859297  0.859297  0.859297 -1.162578  0.859297 -1.162578  0.859297
    ##  [883]  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578  0.859297
    ##  [890]  0.859297 -1.162578 -1.162578  0.859297  0.859297  0.859297 -1.162578
    ##  [897]  0.859297  0.859297  0.859297 -1.162578 -1.162578  0.859297 -1.162578
    ##  [904]  0.859297 -1.162578  0.859297  0.859297 -1.162578 -1.162578 -1.162578
    ##  [911]  0.859297 -1.162578  0.859297 -1.162578 -1.162578  0.859297 -1.162578
    ##  [918] -1.162578  0.859297  0.859297 -1.162578  0.859297 -1.162578 -1.162578
    ##  [925]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [932]  0.859297 -1.162578 -1.162578  0.859297 -1.162578 -1.162578  0.859297
    ##  [939]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [946]  0.859297 -1.162578 -1.162578  0.859297 -1.162578 -1.162578  0.859297
    ##  [953] -1.162578 -1.162578  0.859297 -1.162578  0.859297  0.859297  0.859297
    ##  [960]  0.859297  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [967] -1.162578  0.859297  0.859297 -1.162578  0.859297  0.859297 -1.162578
    ##  [974]  0.859297  0.859297  0.859297  0.859297  0.859297  0.859297 -1.162578
    ##  [981]  0.859297  0.859297 -1.162578  0.859297  0.859297  0.859297  0.859297
    ##  [988]  0.859297  0.859297 -1.162578  0.859297 -1.162578  0.859297  0.859297
    ##  [995]  0.859297  0.859297  0.859297 -1.162578 -1.162578  0.859297

## let’s have multiple outputs

let’s just get the mean and ad from the vector input

``` r
mean_and_sd = function(x){
  
if(!is.numeric(x)){stop("Z scores only work for numbers")}
if(length(x)<3){stop("Z scores really only work if you have three or more numbers")}
  
  mean_x = mean(x)
  sd_x = sd(x)
  
  tibble(
    mean = mean_x,
    sd = sd_x
    
    )
}

mean_and_sd(x= x_vec)
```

    ## # A tibble: 1 × 2
    ##    mean    sd
    ##   <dbl> <dbl>
    ## 1  7.04  3.04

``` r
mean_and_sd(x = 1:10)
```

    ## # A tibble: 1 × 2
    ##    mean    sd
    ##   <dbl> <dbl>
    ## 1   5.5  3.03

``` r
mean_and_sd(x = rbinom(1000, 1, .5))
```

    ## # A tibble: 1 × 2
    ##    mean    sd
    ##   <dbl> <dbl>
    ## 1 0.496 0.500

## let’s start with simulations…

``` r
x_vec = rnorm(n = 25000, mean = 17, sd = 4)
tibble(mean = mean(x_vec),sd = sd(x_vec))
```

    ## # A tibble: 1 × 2
    ##    mean    sd
    ##   <dbl> <dbl>
    ## 1  17.0  4.01

Can I do this using a function… YUP

``` r
sim_mean_sd = function(n_obs, true_mean =7, true_sd = 4){
  x = rnorm(n = n_obs, mean = true_mean, sd = true_sd)
tibble(mean = mean(x),sd = sd(x))
}
```

does it work?

``` r
sim_mean_sd(2500,10,7)
```

    ## # A tibble: 1 × 2
    ##    mean    sd
    ##   <dbl> <dbl>
    ## 1  10.1  7.12

## Fixing bad stuff

``` r
url = "https://www.amazon.com/product-reviews/B00005JNBQ/ref=cm_cr_arp_d_viewopt_rvwer?ie=UTF8&reviewerType=avp_only_reviews&sortBy=recent&pageNumber=1"

dynamite_html = read_html(url)

review_titles = 
  dynamite_html %>%
  html_nodes(".a-text-bold span") %>%
  html_text()

review_stars = 
  dynamite_html %>%
  html_nodes("#cm_cr-review_list .review-rating") %>%
  html_text() %>%
  str_extract("^\\d") %>%
  as.numeric()

review_text = 
  dynamite_html %>%
  html_nodes(".review-text-content span") %>%
  html_text() %>% 
  str_replace_all("\n", "") %>% 
  str_trim()

reviews = tibble(
  title = review_titles,
  stars = review_stars,
  text = review_text
)
```

let’s write a function to get reviews.

``` r
read_page_reviews = function(url){
  
  dynamite_html = read_html(url)

review_titles = 
  dynamite_html %>%
  html_nodes(".a-text-bold span") %>%
  html_text()

review_stars = 
  dynamite_html %>%
  html_nodes("#cm_cr-review_list .review-rating") %>%
  html_text() %>%
  str_extract("^\\d") %>%
  as.numeric()

review_text = 
  dynamite_html %>%
  html_nodes(".review-text-content span") %>%
  html_text() %>% 
  str_replace_all("\n", "") %>% 
  str_trim()%>% 
    str_subset("The media could not be loaded.", negate = TRUE) %>% 
    str_subset("^$", negate = TRUE)

reviews = tibble(
  title = review_titles,
  stars = review_stars,
  text = review_text
)
reviews
}
```

let’s try with a url

``` r
url = "https://www.amazon.com/product-reviews/B00005JNBQ/ref=cm_cr_arp_d_viewopt_rvwer?ie=UTF8&reviewerType=avp_only_reviews&sortBy=recent&pageNumber=5"

read_page_reviews(url)
```

    ## # A tibble: 10 × 3
    ##    title                                                             stars text 
    ##    <chr>                                                             <dbl> <chr>
    ##  1 Low budget fun                                                        5 "Odd…
    ##  2 On a scale of 1 to 10 this rates a minus                              1 "Thi…
    ##  3 I always wondered...                                                  5 "wha…
    ##  4 Audio/video not synced                                                1 "I t…
    ##  5 Kind of feels like only a bully would actually laugh at this...       1 "...…
    ##  6 movie                                                                 5 "goo…
    ##  7 An Overdose of Comical Cringe                                         5 "Exc…
    ##  8 Glad I never wasted money on this                                     2 "I r…
    ##  9 A little disappointed                                                 3 "The…
    ## 10 An (almost) gem. Brought me back to the sweet awkwardness of hig…     5 "To …

What good does this do?

``` r
base_url = "https://www.amazon.com/product-reviews/B00005JNBQ/ref=cm_cr_arp_d_viewopt_rvwer?ie=UTF8&reviewerType=avp_only_reviews&sortBy=recent&pageNumber=5"

vec_url = str_c(base_url,c(1,2,3,4,5))

dynamite_reviews = 
bind_rows(
read_page_reviews(vec_url[1]),
read_page_reviews(vec_url[2]),
read_page_reviews(vec_url[3]),
read_page_reviews(vec_url[4]),
read_page_reviews(vec_url[5]),
)
```
